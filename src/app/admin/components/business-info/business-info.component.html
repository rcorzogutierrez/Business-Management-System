<!-- business-info.component.html -->
<div class="min-h-screen">
  <div class="app-container">

    <!-- ========== HEADER - Usando ModuleHeaderComponent ========== -->
    <app-module-header
      icon="business"
      title="Información de Empresa"
      [subtitle]="headerSubtitle()"
      moduleColor="blue"
      [showBackButton]="true"
      backButtonTooltip="Volver al panel de admin"
      [stats]="headerStats()"
      (backAction)="goBack()">

      <!-- Botones de acción contextuales proyectados -->
      <div slot="actions" class="flex items-center gap-2">
        @if (!editMode() && businessExists()) {
          <button
            type="button"
            class="btn-primary"
            (click)="enableEditMode()">
            <mat-icon>edit</mat-icon>
            Editar
          </button>
        }

        @if (editMode()) {
          <button
            type="button"
            class="btn-cancel"
            (click)="cancelEdit()"
            [disabled]="saving()">
            <mat-icon>close</mat-icon>
            Cancelar
          </button>

          <button
            type="button"
            class="btn-save"
            (click)="onSubmit()"
            [disabled]="saving() || businessForm.invalid">
            @if (saving()) {
              <mat-spinner diameter="18"></mat-spinner>
            } @else {
              <mat-icon>save</mat-icon>
            }
            {{ saving() ? 'Guardando...' : 'Guardar' }}
          </button>
        }
      </div>
    </app-module-header>

    <!-- ============================================
         LOADING STATE
         ============================================ -->
    @if (loading()) {
      <div class="flex flex-col items-center justify-center py-16">
        <mat-spinner diameter="40"></mat-spinner>
        <p class="mt-4 text-sm text-slate-600">Cargando información...</p>
      </div>
    }

    <!-- ============================================
         MAIN CONTENT
         ============================================ -->
    @if (!loading()) {
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-5">

        <!-- ============================================
             LEFT COLUMN - FORMULARIO CON TABS (2/3 width)
             ============================================ -->
        <section class="lg:col-span-2">
          <div class="form-card">

            <!-- Upload Progress Bar -->
            @if (uploadProgress() > 0 && uploadProgress() < 100) {
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="uploadProgress()"></div>
              </div>
            }

            <!-- Tabs -->
            <mat-tab-group class="business-tabs" animationDuration="200ms">

              <!-- ==========================================
                   TAB 1: INFORMACIÓN GENERAL
                   ========================================== -->
              <mat-tab>
                <ng-template mat-tab-label>
                  <div class="tab-label-content">
                    <mat-icon class="tab-icon">info</mat-icon>
                    <span class="tab-text">General</span>
                  </div>
                </ng-template>

                <div class="tab-content">
                  <form [formGroup]="businessForm" class="space-y-4">

                    <!-- Nombre Comercial -->
                    <div class="form-group">
                      <label class="form-label">
                        <mat-icon>store</mat-icon>
                        Nombre Comercial *
                      </label>
                      <div class="input-wrapper">
                        <input
                          type="text"
                          formControlName="businessName"
                          placeholder="Ej: Mi Empresa"
                          maxlength="100"
                          class="form-input"
                          [class.error]="isFieldInvalid('businessName')"
                        />
                        <span class="char-count">{{ businessForm.get('businessName')?.value?.length || 0 }}/100</span>
                      </div>
                      @if (isFieldInvalid('businessName')) {
                        <p class="error-text">{{ getErrorMessage('businessName') }}</p>
                      }
                    </div>

                    <!-- Razón Social -->
                    <div class="form-group">
                      <label class="form-label">
                        <mat-icon>gavel</mat-icon>
                        Razón Social / Nombre Legal
                      </label>
                      <div class="input-wrapper">
                        <input
                          type="text"
                          formControlName="legalName"
                          placeholder="Ej: Mi Empresa S.A."
                          maxlength="150"
                          class="form-input"
                          [class.error]="isFieldInvalid('legalName')"
                        />
                        <span class="char-count">{{ businessForm.get('legalName')?.value?.length || 0 }}/150</span>
                      </div>
                      @if (isFieldInvalid('legalName')) {
                        <p class="error-text">{{ getErrorMessage('legalName') }}</p>
                      }
                    </div>

                    <!-- RIF / Tax ID -->
                    <div class="form-group">
                      <label class="form-label">
                        <mat-icon>badge</mat-icon>
                        RIF / Tax ID / NIT
                      </label>
                      <input
                        type="text"
                        formControlName="taxId"
                        placeholder="Ej: J-12345678-9"
                        maxlength="30"
                        class="form-input"
                        [class.error]="isFieldInvalid('taxId')"
                      />
                      @if (isFieldInvalid('taxId')) {
                        <p class="error-text">{{ getErrorMessage('taxId') }}</p>
                      }
                    </div>

                    <!-- Descripción -->
                    <div class="form-group">
                      <label class="form-label">
                        <mat-icon>description</mat-icon>
                        Descripción de la Empresa
                      </label>
                      <div class="input-wrapper">
                        <textarea
                          formControlName="description"
                          placeholder="Breve descripción de tu empresa..."
                          rows="3"
                          maxlength="500"
                          class="form-input"
                          [class.error]="isFieldInvalid('description')"
                        ></textarea>
                        <span class="char-count textarea">{{ businessForm.get('description')?.value?.length || 0 }}/500</span>
                      </div>
                      <p class="form-hint">
                        <mat-icon>info_outline</mat-icon>
                        Opcional: información adicional sobre tu empresa
                      </p>
                    </div>

                  </form>
                </div>
              </mat-tab>

              <!-- ==========================================
                   TAB 2: CONTACTO
                   ========================================== -->
              <mat-tab>
                <ng-template mat-tab-label>
                  <div class="tab-label-content">
                    <mat-icon class="tab-icon">contacts</mat-icon>
                    <span class="tab-text">Contacto</span>
                  </div>
                </ng-template>

                <div class="tab-content">
                  <form [formGroup]="businessForm" class="space-y-5">

                    <!-- Emails (dinámicos) -->
                    <div class="dynamic-section">
                      <div class="section-header">
                        <label class="form-label green">
                          <mat-icon>email</mat-icon>
                          Emails de Contacto *
                        </label>
                        @if (editMode()) {
                          <button
                            type="button"
                            class="add-btn"
                            (click)="addEmail()"
                            title="Agregar email">
                            <mat-icon>add</mat-icon>
                          </button>
                        }
                      </div>

                      <div formArrayName="emails" class="space-y-3">
                        @for (emailGroup of emails.controls; track $index) {
                          <div [formGroupName]="$index" class="dynamic-row">
                            <input
                              type="text"
                              formControlName="label"
                              placeholder="Etiqueta"
                              maxlength="30"
                              class="form-input label-input"
                            />
                            <input
                              type="email"
                              formControlName="value"
                              placeholder="email@empresa.com"
                              class="form-input flex-1"
                              [class.error]="emailGroup.get('value')?.invalid && emailGroup.get('value')?.touched"
                            />
                            @if (editMode() && emails.length > 1) {
                              <button
                                type="button"
                                class="remove-btn"
                                (click)="removeEmail($index)"
                                title="Eliminar email">
                                <mat-icon>delete</mat-icon>
                              </button>
                            }
                          </div>
                        }
                      </div>
                    </div>

                    <!-- Teléfonos (dinámicos) -->
                    <div class="dynamic-section">
                      <div class="section-header">
                        <label class="form-label green">
                          <mat-icon>phone</mat-icon>
                          Teléfonos de Contacto
                        </label>
                        @if (editMode()) {
                          <button
                            type="button"
                            class="add-btn"
                            (click)="addPhone()"
                            title="Agregar teléfono">
                            <mat-icon>add</mat-icon>
                          </button>
                        }
                      </div>

                      <div formArrayName="phones" class="space-y-3">
                        @for (phoneGroup of phones.controls; track $index) {
                          <div [formGroupName]="$index" class="dynamic-row">
                            <input
                              type="text"
                              formControlName="label"
                              placeholder="Etiqueta"
                              maxlength="30"
                              class="form-input label-input"
                            />
                            <input
                              type="tel"
                              formControlName="value"
                              placeholder="+58 212 1234567"
                              maxlength="20"
                              class="form-input flex-1"
                              [class.error]="phoneGroup.get('value')?.invalid && phoneGroup.get('value')?.touched"
                            />
                            @if (editMode() && phones.length > 1) {
                              <button
                                type="button"
                                class="remove-btn"
                                (click)="removePhone($index)"
                                title="Eliminar teléfono">
                                <mat-icon>delete</mat-icon>
                              </button>
                            }
                          </div>
                        }
                      </div>
                    </div>

                    <!-- Website -->
                    <div class="form-group">
                      <label class="form-label green">
                        <mat-icon>language</mat-icon>
                        Sitio Web
                      </label>
                      <input
                        type="url"
                        formControlName="website"
                        placeholder="https://www.empresa.com"
                        class="form-input"
                        [class.error]="isFieldInvalid('website')"
                      />
                      @if (isFieldInvalid('website')) {
                        <p class="error-text">{{ getErrorMessage('website') }}</p>
                      }
                    </div>

                  </form>
                </div>
              </mat-tab>

              <!-- ==========================================
                   TAB 3: DIRECCIÓN
                   ========================================== -->
              <mat-tab>
                <ng-template mat-tab-label>
                  <div class="tab-label-content">
                    <mat-icon class="tab-icon">location_on</mat-icon>
                    <span class="tab-text">Dirección</span>
                  </div>
                </ng-template>

                <div class="tab-content">
                  <form [formGroup]="businessForm">
                    <div formGroupName="address" class="space-y-4">

                      <!-- Calle -->
                      <div class="form-group">
                        <label class="form-label purple">
                          <mat-icon>home</mat-icon>
                          Calle y Número
                        </label>
                        <input
                          type="text"
                          formControlName="street"
                          placeholder="Ej: Av. Principal, Edif. Torre, Piso 5"
                          maxlength="200"
                          class="form-input"
                          [class.error]="isFieldInvalid('street', 'address')"
                        />
                        @if (isFieldInvalid('street', 'address')) {
                          <p class="error-text">{{ getErrorMessage('street', 'address') }}</p>
                        }
                      </div>

                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Ciudad -->
                        <div class="form-group">
                          <label class="form-label purple">
                            <mat-icon>location_city</mat-icon>
                            Ciudad
                          </label>
                          <input
                            type="text"
                            formControlName="city"
                            placeholder="Ej: Caracas"
                            maxlength="100"
                            class="form-input"
                            [class.error]="isFieldInvalid('city', 'address')"
                          />
                          @if (isFieldInvalid('city', 'address')) {
                            <p class="error-text">{{ getErrorMessage('city', 'address') }}</p>
                          }
                        </div>

                        <!-- Estado/Provincia -->
                        <div class="form-group">
                          <label class="form-label purple">
                            <mat-icon>map</mat-icon>
                            Estado / Provincia
                          </label>
                          <input
                            type="text"
                            formControlName="state"
                            placeholder="Ej: Distrito Capital"
                            maxlength="100"
                            class="form-input"
                            [class.error]="isFieldInvalid('state', 'address')"
                          />
                          @if (isFieldInvalid('state', 'address')) {
                            <p class="error-text">{{ getErrorMessage('state', 'address') }}</p>
                          }
                        </div>

                        <!-- Código Postal -->
                        <div class="form-group">
                          <label class="form-label purple">
                            <mat-icon>markunread_mailbox</mat-icon>
                            Código Postal
                          </label>
                          <input
                            type="text"
                            formControlName="zipCode"
                            placeholder="Ej: 1050"
                            maxlength="20"
                            class="form-input"
                            [class.error]="isFieldInvalid('zipCode', 'address')"
                          />
                          @if (isFieldInvalid('zipCode', 'address')) {
                            <p class="error-text">{{ getErrorMessage('zipCode', 'address') }}</p>
                          }
                        </div>

                        <!-- País -->
                        <div class="form-group">
                          <label class="form-label purple">
                            <mat-icon>public</mat-icon>
                            País
                          </label>
                          <input
                            type="text"
                            formControlName="country"
                            placeholder="Ej: Venezuela"
                            maxlength="100"
                            class="form-input"
                            [class.error]="isFieldInvalid('country', 'address')"
                          />
                          @if (isFieldInvalid('country', 'address')) {
                            <p class="error-text">{{ getErrorMessage('country', 'address') }}</p>
                          }
                        </div>
                      </div>

                    </div>
                  </form>
                </div>
              </mat-tab>

              <!-- ==========================================
                   TAB 4: BRANDING
                   ========================================== -->
              <mat-tab>
                <ng-template mat-tab-label>
                  <div class="tab-label-content">
                    <mat-icon class="tab-icon">palette</mat-icon>
                    <span class="tab-text">Branding</span>
                  </div>
                </ng-template>

                <div class="tab-content">
                  <form [formGroup]="businessForm" class="space-y-6">

                    <!-- Logo Section -->
                    <div class="branding-section">
                      <h3 class="section-title amber">
                        <mat-icon>image</mat-icon>
                        Logo de la Empresa
                      </h3>

                      <!-- Logo Preview -->
                      <div class="logo-preview-zone">
                        @if (logoPreview()) {
                          <div class="relative group">
                            <div class="logo-preview-box">
                              <img
                                [src]="logoPreview()"
                                alt="Logo preview"
                                class="w-full h-full object-contain p-3"
                              />
                            </div>
                            @if (editMode()) {
                              <div class="logo-overlay">
                                <button
                                  type="button"
                                  class="logo-delete-btn"
                                  (click)="logoPreview.set(''); selectedLogoFile.set(null)"
                                  title="Eliminar logo">
                                  <mat-icon>delete</mat-icon>
                                </button>
                              </div>
                            }
                          </div>
                        } @else {
                          <div class="logo-placeholder">
                            <mat-icon>image</mat-icon>
                          </div>
                        }
                        <p class="text-xs text-slate-500 font-medium mt-2">
                          {{ logoPreview() ? 'Logo actual' : 'Sin logo' }}
                        </p>
                      </div>

                      <!-- Upload Button -->
                      @if (editMode()) {
                        <div class="mt-4">
                          <input
                            type="file"
                            #logoInput
                            accept="image/*"
                            (change)="onLogoSelected($event)"
                            class="hidden"
                          />
                          <button
                            type="button"
                            class="btn-upload w-full"
                            (click)="logoInput.click()">
                            <mat-icon>cloud_upload</mat-icon>
                            {{ logoPreview() ? 'Cambiar Logo' : 'Subir Logo' }}
                          </button>
                          <p class="text-xs text-slate-500 text-center mt-2">
                            Formatos: JPG, PNG, SVG • Máx. 5MB
                          </p>
                        </div>
                      }

                      <input type="hidden" formControlName="logoUrl">
                    </div>

                    <div class="section-divider"></div>

                    <!-- Colors Section -->
                    <div class="branding-section">
                      <h3 class="section-title amber">
                        <mat-icon>color_lens</mat-icon>
                        Colores Corporativos
                      </h3>

                      <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <!-- Color Primario -->
                        <div class="color-picker-group">
                          <label class="form-label">Color Primario</label>
                          <div class="color-picker-row">
                            <input
                              type="color"
                              formControlName="primaryColor"
                              class="color-picker"
                            />
                            <input
                              type="text"
                              formControlName="primaryColor"
                              placeholder="#3b82f6"
                              class="color-input"
                            />
                          </div>
                          <p class="form-hint">
                            <mat-icon>info_outline</mat-icon>
                            Color principal de tu marca
                          </p>
                        </div>

                        <!-- Color Secundario -->
                        <div class="color-picker-group">
                          <label class="form-label">Color Secundario</label>
                          <div class="color-picker-row">
                            <input
                              type="color"
                              formControlName="secondaryColor"
                              class="color-picker"
                            />
                            <input
                              type="text"
                              formControlName="secondaryColor"
                              placeholder="#8b5cf6"
                              class="color-input"
                            />
                          </div>
                          <p class="form-hint">
                            <mat-icon>info_outline</mat-icon>
                            Color complementario
                          </p>
                        </div>
                      </div>
                    </div>

                  </form>
                </div>
              </mat-tab>

              <!-- ==========================================
                   TAB 5: AÑO FISCAL
                   ========================================== -->
              <mat-tab>
                <ng-template mat-tab-label>
                  <div class="tab-label-content">
                    <mat-icon class="tab-icon">calendar_today</mat-icon>
                    <span class="tab-text">Año Fiscal</span>
                  </div>
                </ng-template>

                <div class="tab-content">
                  <form [formGroup]="businessForm">
                    <div formGroupName="fiscalYear" class="space-y-5">

                      <!-- Info contextual -->
                      <div class="rounded-xl bg-blue-50 border border-blue-200 p-4 flex gap-3">
                        <mat-icon class="text-blue-500 shrink-0 mt-0.5">info</mat-icon>
                        <div class="text-sm text-blue-700">
                          <p class="font-semibold mb-1">¿Qué es el Año Fiscal?</p>
                          <p>Define el período contable de la empresa. Afecta la numeración de documentos (estimados, facturas) y los reportes financieros. El cambio aplica a documentos creados a partir de esta configuración.</p>
                        </div>
                      </div>

                      <!-- Fecha de inicio -->
                      <div>
                        <h3 class="section-title" style="color: #3b82f6;">
                          <mat-icon>event</mat-icon>
                          Fecha de Inicio del Año Fiscal
                        </h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">

                          <!-- Mes de inicio -->
                          <div class="form-group">
                            <label class="form-label">
                              <mat-icon>calendar_month</mat-icon>
                              Mes de Inicio *
                            </label>
                            <select
                              formControlName="startMonth"
                              class="form-input"
                              [class.error]="isFieldInvalid('startMonth', 'fiscalYear')">
                              <option [value]="1">Enero</option>
                              <option [value]="2">Febrero</option>
                              <option [value]="3">Marzo</option>
                              <option [value]="4">Abril</option>
                              <option [value]="5">Mayo</option>
                              <option [value]="6">Junio</option>
                              <option [value]="7">Julio</option>
                              <option [value]="8">Agosto</option>
                              <option [value]="9">Septiembre</option>
                              <option [value]="10">Octubre</option>
                              <option [value]="11">Noviembre</option>
                              <option [value]="12">Diciembre</option>
                            </select>
                            <p class="form-hint">
                              <mat-icon>info_outline</mat-icon>
                              Mes en que comienza el año fiscal
                            </p>
                            @if (isFieldInvalid('startMonth', 'fiscalYear')) {
                              <p class="error-text">{{ getErrorMessage('startMonth', 'fiscalYear') }}</p>
                            }
                          </div>

                          <!-- Día de inicio -->
                          <div class="form-group">
                            <label class="form-label">
                              <mat-icon>today</mat-icon>
                              Día de Inicio *
                            </label>
                            <input
                              type="number"
                              formControlName="startDay"
                              min="1"
                              max="31"
                              class="form-input"
                              [class.error]="isFieldInvalid('startDay', 'fiscalYear')"
                            />
                            <p class="form-hint">
                              <mat-icon>info_outline</mat-icon>
                              Día del mes (1-31). Lo más común es el día 1.
                            </p>
                            @if (isFieldInvalid('startDay', 'fiscalYear')) {
                              <p class="error-text">{{ getErrorMessage('startDay', 'fiscalYear') }}</p>
                            }
                          </div>

                        </div>
                      </div>

                      <div class="section-divider"></div>

                      <!-- Formato de etiqueta -->
                      <div>
                        <h3 class="section-title" style="color: #3b82f6;">
                          <mat-icon>label</mat-icon>
                          Formato de Etiqueta
                        </h3>
                        <p class="text-sm text-slate-500 mb-3">Define cómo se mostrará el año fiscal en documentos y reportes.</p>

                        <div class="form-group mt-3">
                          <label class="form-label">
                            <mat-icon>format_list_bulleted</mat-icon>
                            Formato *
                          </label>
                          <select
                            formControlName="labelFormat"
                            class="form-input"
                            [class.error]="isFieldInvalid('labelFormat', 'fiscalYear')">
                            <option value="FY{YY}">FY{YY} — Ejemplo: FY26</option>
                            <option value="FY{YYYY}">FY{YYYY} — Ejemplo: FY2026</option>
                            <option value="{YYYY}-{YYYY+1}">{YYYY}-{YYYY+1} — Ejemplo: 2025-2026</option>
                          </select>
                          <p class="form-hint">
                            <mat-icon>info_outline</mat-icon>
                            El prefijo se usará en la numeración de documentos (ej: <strong>FY26-0001</strong>)
                          </p>
                          @if (isFieldInvalid('labelFormat', 'fiscalYear')) {
                            <p class="error-text">{{ getErrorMessage('labelFormat', 'fiscalYear') }}</p>
                          }
                        </div>
                      </div>

                      <div class="section-divider"></div>

                      <!-- Período activo calculado -->
                      <div class="rounded-xl bg-slate-50 border border-slate-200 p-4">
                        <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">Año fiscal activo (guardado)</p>
                        <p class="text-sm font-semibold text-slate-700">{{ fiscalYearPreview() }}</p>
                        <p class="text-xs text-slate-400 mt-1">Basado en la configuración guardada actualmente.</p>
                      </div>

                    </div>
                  </form>
                </div>
              </mat-tab>

              <!-- ==========================================
                   TAB 6: REDES SOCIALES
                   ========================================== -->
              <mat-tab>
                <ng-template mat-tab-label>
                  <div class="tab-label-content">
                    <mat-icon class="tab-icon">share</mat-icon>
                    <span class="tab-text">Redes</span>
                  </div>
                </ng-template>

                <div class="tab-content">
                  <form [formGroup]="businessForm">
                    <div formGroupName="socialMedia" class="space-y-4">

                      <!-- Facebook -->
                      <div class="form-group">
                        <label class="form-label social facebook">
                          <mat-icon>facebook</mat-icon>
                          Facebook
                        </label>
                        <input
                          type="url"
                          formControlName="facebook"
                          placeholder="https://www.facebook.com/tuempresa"
                          class="form-input"
                          [class.error]="isFieldInvalid('facebook', 'socialMedia')"
                        />
                        @if (isFieldInvalid('facebook', 'socialMedia')) {
                          <p class="error-text">{{ getErrorMessage('facebook', 'socialMedia') }}</p>
                        }
                      </div>

                      <!-- Instagram -->
                      <div class="form-group">
                        <label class="form-label social instagram">
                          <mat-icon>camera_alt</mat-icon>
                          Instagram
                        </label>
                        <input
                          type="url"
                          formControlName="instagram"
                          placeholder="https://www.instagram.com/tuempresa"
                          class="form-input"
                          [class.error]="isFieldInvalid('instagram', 'socialMedia')"
                        />
                        @if (isFieldInvalid('instagram', 'socialMedia')) {
                          <p class="error-text">{{ getErrorMessage('instagram', 'socialMedia') }}</p>
                        }
                      </div>

                      <!-- Twitter -->
                      <div class="form-group">
                        <label class="form-label social twitter">
                          <mat-icon>tag</mat-icon>
                          Twitter / X
                        </label>
                        <input
                          type="url"
                          formControlName="twitter"
                          placeholder="https://www.twitter.com/tuempresa"
                          class="form-input"
                          [class.error]="isFieldInvalid('twitter', 'socialMedia')"
                        />
                        @if (isFieldInvalid('twitter', 'socialMedia')) {
                          <p class="error-text">{{ getErrorMessage('twitter', 'socialMedia') }}</p>
                        }
                      </div>

                      <!-- LinkedIn -->
                      <div class="form-group">
                        <label class="form-label social linkedin">
                          <mat-icon>work</mat-icon>
                          LinkedIn
                        </label>
                        <input
                          type="url"
                          formControlName="linkedin"
                          placeholder="https://www.linkedin.com/company/tuempresa"
                          class="form-input"
                          [class.error]="isFieldInvalid('linkedin', 'socialMedia')"
                        />
                        @if (isFieldInvalid('linkedin', 'socialMedia')) {
                          <p class="error-text">{{ getErrorMessage('linkedin', 'socialMedia') }}</p>
                        }
                      </div>

                    </div>
                  </form>
                </div>
              </mat-tab>

            </mat-tab-group>

          </div>
        </section>

        <!-- ============================================
             RIGHT COLUMN - PREVIEW (1/3 width)
             ============================================ -->
        <section class="lg:col-span-1">

          <!-- CARD: VISTA PREVIA -->
          <div class="preview-card">
            <div class="card-header">
              <div class="card-icon cyan">
                <mat-icon>preview</mat-icon>
              </div>
              <h2 class="card-title">Vista Previa</h2>
            </div>

            <div class="space-y-4">

              <!-- Preview: Logo -->
              <div class="preview-section">
                <p class="preview-label">Logo</p>
                <div class="preview-logo-container">
                  @if (logoPreview()) {
                    <div class="preview-logo">
                      <img
                        [src]="logoPreview()"
                        alt="Logo preview"
                        class="w-full h-full object-contain p-2"
                      />
                    </div>
                  } @else {
                    <div class="preview-logo empty">
                      <mat-icon>image</mat-icon>
                    </div>
                  }
                </div>
              </div>

              <!-- Preview: Información -->
              <div class="preview-section">
                <p class="preview-label">Información</p>
                <div class="preview-info">
                  <h3 class="preview-business-name">
                    {{ businessForm.get('businessName')?.value || 'Nombre de Empresa' }}
                  </h3>
                  <p class="preview-legal-name">
                    {{ businessForm.get('legalName')?.value || 'Razón Social' }}
                  </p>
                  @if (businessForm.get('description')?.value) {
                    <p class="preview-description">
                      {{ businessForm.get('description')?.value }}
                    </p>
                  }
                </div>
              </div>

              <!-- Preview: Contacto -->
              <div class="preview-section">
                <p class="preview-label">Contacto</p>
                <div class="preview-contact">
                  @for (emailGroup of emails.controls; track $index) {
                    @if (emailGroup.get('value')?.value) {
                      <div class="contact-item">
                        <mat-icon>email</mat-icon>
                        <div>
                          <span class="contact-label">{{ emailGroup.get('label')?.value || 'Email' }}</span>
                          <span class="contact-value">{{ emailGroup.get('value')?.value }}</span>
                        </div>
                      </div>
                    }
                  }
                  @for (phoneGroup of phones.controls; track $index) {
                    @if (phoneGroup.get('value')?.value) {
                      <div class="contact-item">
                        <mat-icon>phone</mat-icon>
                        <div>
                          <span class="contact-label">{{ phoneGroup.get('label')?.value || 'Teléfono' }}</span>
                          <span class="contact-value">{{ phoneGroup.get('value')?.value }}</span>
                        </div>
                      </div>
                    }
                  }
                </div>
              </div>

              <!-- Preview: Colores -->
              <div class="preview-section">
                <p class="preview-label">Colores</p>
                <div class="preview-colors">
                  <div class="color-preview">
                    <div
                      class="color-box"
                      [style.background]="businessForm.get('primaryColor')?.value || '#3b82f6'">
                    </div>
                    <span class="color-value">{{ businessForm.get('primaryColor')?.value || '#3b82f6' }}</span>
                  </div>
                  <div class="color-preview">
                    <div
                      class="color-box"
                      [style.background]="businessForm.get('secondaryColor')?.value || '#8b5cf6'">
                    </div>
                    <span class="color-value">{{ businessForm.get('secondaryColor')?.value || '#8b5cf6' }}</span>
                  </div>
                </div>
              </div>

              <!-- Preview: Año Fiscal -->
              <div class="preview-section">
                <p class="preview-label">Año Fiscal</p>
                <div class="flex items-center gap-2 mt-1">
                  <mat-icon class="text-blue-400 text-sm" style="font-size:16px;width:16px;height:16px;">calendar_today</mat-icon>
                  <span class="text-sm font-semibold text-slate-700">{{ fiscalYearService.currentFY().label }}</span>
                  <span class="text-xs text-slate-400 font-mono">→ prefijo: {{ fiscalYearService.currentFY().prefix }}</span>
                </div>
                <p class="text-xs text-slate-400 mt-1">{{ fiscalYearPreview() }}</p>
              </div>

            </div>
          </div>

        </section>

      </div>
    }

  </div>
</div>
